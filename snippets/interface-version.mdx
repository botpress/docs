export const CurrentInterfaceVersion = ({ interfaceName, fallback }) => {
  const getCurrentVersion = async () => {
    const definitionUrl = `https://api.botpress.cloud/v1/admin/hub/interfaces/${interfaceName}/latest`
    try {
      const response = await fetch(definitionUrl)
      if (!response.ok) {
        throw new Error(`Failed to fetch interface definition: ${response.statusText}`)
      }

      const definition = await response.json()
      return definition.interface?.version ?? fallback ?? 'unknown'
    } catch (error) {
      console.error(error)
    }
    return fallback ?? 'unknown'
  }

  if (typeof document === "undefined") {
    return null;
  }

  const componentClassName = `iface-version-${interfaceName}`;

  requestIdleCallback(() =>
    getCurrentVersion().then((version) => {
      Array.from(document.getElementsByClassName(componentClassName))
        .forEach((component) => {
          component.innerHTML = version
        })
    }));

  return (<span class={componentClassName}>{fallback ?? 'loading...'}</span>)
}
